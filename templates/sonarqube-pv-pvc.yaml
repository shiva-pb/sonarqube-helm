apiVersion: v1
kind: PersistentVolume
metadata:
  name: {{ .Values.name.sq }}-pv
spec:
  capacity:
    storage: {{ .Values.sonarqube.storage }}
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: ""  # Critical: Empty string prevents dynamic provisioning
  claimRef:  # Critical: Pre-bind to specific PVC
    name: {{ .Values.name.sq }}-pvc
    namespace: tools
  hostPath:
    path: "{{ .Values.sonarqube.hostPath }}"
    type: DirectoryOrCreate
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ .Values.name.sq }}-pvc
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: ""  # Critical: Must match PV
  volumeName: {{ .Values.name.sq }}-pv  # Critical: Explicit binding
  resources:
    requests:
      storage: {{ .Values.sonarqube.storage }}